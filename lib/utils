# shellcheck shell=bash

check_cmd() {
    if [[ -z "$(command -v "$1")" ]]; then
        return 1
    fi
}

check_brew() {
    if command -v brew >&/dev/null; then
        bannerColor "Your system has Homebrew installed." "green" "*"
    else
        bannerColor "Installing Homewbrew ..." "green" "*"
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
        # append to ~/.zshrc
        # shellcheck disable=SC2016
        echo 'export PATH=$(brew --prefix)/bin:$PATH >> $HOME/.zshrc'
        # source the ~/.zshrc file
        # shellcheck disable=SC1091
        source "$HOME/.zshrc"
        bannerColor "Homebrew installation completed." "green" "*"
    fi
    return 0
}

check_sed() {
    if brew list gnu-sed >&/dev/null; then
        bannerColor "Your system has gnu-sed installed." "green" "*"
    else
        # this install gsed and add a path so that you can use sed command
        bannerColor "Installing GNU-sed..." "green" "*"
        "$(brew --prefix)"/bin/brew install gnu-sed
        # shellcheck disable=SC2016
        echo 'export PATH="$(brew --prefix)/opt/gnu-sed/libexec/gnubin:$PATH"' >>"$HOME"/.zshrc
        bannerColor "GNU-sed installation completed. The PATH is added to .zshrc" "green" "*"
    fi
}

check_iterm() {
    if brew list --cask iterm2 >&/dev/null; then
        bannerColor "Your system has iTerm2 installed." "green" "*"
    else
        bannerColor "Installing iTerm2 ..." "green" "*"
        brew install --cask iterm2
        bannerColor "iTerm2 installation completed." "green" "*"
    fi
}

check_zsh() {
    if command -v zsh; then
        bannerColor "Your system has zsh installed." "green" "*"
    else
        bannerColor "Installing zsh ..." "green" "*"
        brew install zsh
        bannerColor "Zsh installation completed." "green" "*"
    fi
}

check_omz() {
    if [[ -d $HOME/.oh-my-zsh ]]; then
        bannerColor "Your system has already Oh My Zsh installed." "green" "*"
    else
        bannerColor "Installing Oh My Zsh ..." "green" "*"
        sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
        bannerColor "Oh My Zsh installation completed. Updating Oh My Zsh..." "green" "*"
        # add export PATH=$(brew --prefix)/bin:$PATH to $HOME/.zshrc BEFORE plugins
        # shellcheck disable=SC2016
        sed -i 'plugins=(git)/i export PATH=$(brew --prefix)/bin:$PATH' "$HOME"/.zshrc
        omz update
        bannerColor "Oh My Zsh updated." "green" "*"
        chmod 755 "$(brew --prefix)"/share/zsh
        chmod 755 "$(brew --prefix)"/share/zsh/site-functions
        bannerColor "If the installation is ended after this, please run ati again." "yellow" "*"
    fi
}

check_firacode() {
    if brew list --cask font-fira-code >&/dev/null; then
        bannerColor "Your system has Fira Code installed." "green" "*"
    else
        bannerColor "Installing Fira Code font..." "green" "*"
        brew tap homebrew/cask-fonts && brew install --cask font-fira-code
        bannerColor "Fira Code font installation completed." "green" "*"
    fi
}

add_plugins() {
    bannerColor "Adding plugins" "green" "*"
    # autojump
    if ! brew list autojump >&/dev/null; then
        bannerColor "Installing autojump..." "green" "*"
        "$(brew --prefix)"/bin/brew install autojump
        # shellcheck disable=SC2016
        echo '[ -f $(brew --prefix)/etc/profile.d/autojump.sh ] && . $(brew --prefix)/etc/profile.d/autojump.sh' >>"$HOME"/.zshrc
        bannerColor "PATH is added to .zshrc." "green" "*"
    fi
    if ! brew list zsh-syntax-highlighting >&/dev/null; then
        bannerColor "Installing zsh-syntax-highlighting..." "green" "*"
        # zsh-syntax-highlighting
        "$(brew --prefix)"/bin/brew install zsh-syntax-highlighting
        bannerColor "zsh-syntax-highlighting installation completed." "green" "*"
    fi
    bannerColor "Installing zsh-autosuggestions..." "green" "*"
    # zsh-autosuggestions
    /usr/bin/git clone https://github.com/zsh-users/zsh-autosuggestions "${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}"/plugins/zsh-autosuggestions
    # replace plugins to plugins=(git brew zsh-syntax-highlighting zsh-autosuggestions)
    sed -i "s/plugins=(git)/plugins=(git autojump brew zsh-syntax-highlighting zsh-autosuggestions brew)/" "$HOME"/.zshrc
    # run source $HOME/.zshrc
    # shellcheck disable=SC1091
    source "$HOME/.zshrc"
    bannerColor "zsh-autosuggestions installation completed." "green" "*"
}

check_starship() {
    if command -v starship; then
        bannerColor "Your system has Starship installed." "green" "*"
    else
        bannerColor "Installing Starship ..." "green" "*"
        brew install starship
        bannerColor "Starship installation completed." "green" "*"
        # shellcheck disable=SC2016
        echo 'eval "$(starship init zsh)"' >>~/.zshrc
        bannerColor "Starship installation completed." "green" "*"
    fi
}
