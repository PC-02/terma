# shellcheck shell=bash

check_cmd() {
    if [[ -z "$(command -v "$1")" ]]; then
        return 1
    fi
}

check_brew() {
    if command -v brew >&/dev/null; then
        echo "Your system has Homebrew installed."
    else
        echo "Installing Homewbrew ..."
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
        # append to ~/.zshrc
        # shellcheck disable=SC2016
        echo 'export PATH=$(brew --prefix)/bin:$PATH >> $HOME/.zshrc'
        # source the ~/.zshrc file
        # shellcheck disable=SC1091
        source "$HOME/.zshrc"
        echo "Homebrew installation completed."
    fi
    return 0
}

check_sed() {
    if brew list gnu-sed >&/dev/null; then
        echo "Your system has gnu-sed installed."
    else
        # this install gsed and add a path so that you can use sed command
        echo "Installing GNU-sed..."
        "$(brew --prefix)"/bin/brew install gnu-sed
        # shellcheck disable=SC2016
        echo 'export PATH="$(brew --prefix)/opt/gnu-sed/libexec/gnubin:$PATH"' >>"$HOME"/.zshrc
    fi
}

check_iterm() {
    if brew list --cask iterm2 >&/dev/null; then
        echo "Your system has iTerm2 installed."
    else
        echo "Installing iTerm2 ..."
        brew install --cask iterm2
        echo "iTerm2 installation completed."
    fi
}

check_zsh() {
    if command -v zsh; then
        echo "Your system has zsh installed."
    else
        echo "Installing zsh ..."
        brew install zsh
        echo "Zsh installation completed."
    fi
}

check_omz() {
    if [[ -d $HOME/.oh-my-zsh ]]; then
        echo "Your system has already Oh My Zsh installed."
    else
        echo "Installing Oh My Zsh ..."
        sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
        echo "Oh My Zsh installation completed. Updating Oh My Zsh..."
        # add export PATH=$(brew --prefix)/bin:$PATH to $HOME/.zshrc BEFORE plugins
        # shellcheck disable=SC2016
        sed -i 'plugins=(git)/i export PATH=$(brew --prefix)/bin:$PATH' "$HOME"/.zshrc
        omz update
        echo "Oh My Zsh updated."
        chmod 755 "$(brew --prefix)"/share/zsh
        chmod 755 "$(brew --prefix)"/share/zsh/site-functions
    fi
}

check_firacode() {
    if brew list --cask font-fira-code >&/dev/null; then
        echo "Your system has Fira Code installed."
    else
        echo "Installing Fira Code font..."
        brew tap homebrew/cask-fonts && brew install --cask font-fira-code
        echo "Fira Code font installation completed."
    fi
}

add_plugins() {
    echo "Adding plugins"
    # autojump
    if ! brew list autojump >&/dev/null; then
        echo "Installing autojump..."
        "$(brew --prefix)"/bin/brew install autojump
    fi
    if ! brew list zsh-syntax-highlighting >&/dev/null; then
        echo "Installing zsh-syntax-highlighting..."
        # zsh-syntax-highlighting
        "$(brew --prefix)"/bin/brew install zsh-syntax-highlighting
    fi
    echo "Installing zsh-autosuggestions..."
    # zsh-autosuggestions
    /usr/bin/git clone https://github.com/zsh-users/zsh-autosuggestions "${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}"/plugins/zsh-autosuggestions
    # replace plugins to plugins=(git brew zsh-syntax-highlighting zsh-autosuggestions)
    sed -i 's/plugins=(git)/plugins=(git autojump brew zsh-syntax-highlighting zsh-autosuggestions brew)/' "$HOME"/.zshrc
    # run source $HOME/.zshrc
    # shellcheck disable=SC1091
    source "$HOME/.zshrc"
}

check_starship() {
    if command -v starship; then
        echo "Your system has starship installed."
    else
        echo "Installing starship ..."
        brew install starship
        echo "Installed starship."
        # shellcheck disable=SC2016
        echo 'eval "$(starship init zsh)"' >>~/.zshrc
    fi
}
